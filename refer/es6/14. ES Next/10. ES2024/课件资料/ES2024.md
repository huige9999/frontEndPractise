# ES2024

ES2024ï¼ˆES15ï¼‰æ–°ç‰¹æ€§å¦‚ä¸‹ï¼š

1. GroupByåˆ†ç»„
2. Promise.withResolvers
3. æ­£åˆ™è¡¨è¾¾å¼çš„ /v æ ‡å¿—

**1. GroupByåˆ†ç»„**

GroupBy æ˜¯ ES2024 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå®ƒä»¬ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å¼ºå¤§çš„åˆ†ç»„åŠŸèƒ½ï¼Œå…è®¸æ ¹æ®ç‰¹å®šçš„å›è°ƒå‡½æ•°å¯¹æ•°ç»„æˆ–å¯¹è±¡ä¸­çš„å…ƒç´ è¿›è¡Œåˆ†ç»„ã€‚è¯¥æ–°ç‰¹æ€§åœ¨åˆ†æç»Ÿè®¡æ•°æ®æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å°†ç”¨æˆ·æŒ‰å¹´é¾„æ®µåˆ†ç»„ã€æŒ‰é”€å”®é¢åˆ†ç»„ç­‰ï¼Œå¯ä»¥è½»æ¾å®ç°ã€‚åˆ†ç»„å¯¹åº”çš„æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š

1. Object.groupBy( )ï¼šè¿”å›ä¸€ä¸ªå¯¹è±¡
2. Map.groupBy( )ï¼šè¿”å›ä¸€ä¸ª Map

Object.groupBy( ) è¯­æ³•å¦‚ä¸‹ï¼š

```js
Object.groupBy(array, callback);
```

- arrayï¼šéœ€è¦åˆ†ç»„çš„æ•°ç»„
- callbackï¼šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨æ¥ç¡®å®šåˆ†ç»„ä¾æ®ã€‚å®ƒä¼šæ¥æ”¶å½“å‰æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›ç”¨äºåˆ†ç»„çš„é”®å€¼ã€‚

```js
const fruits = [
  { name: "apple", type: "pome" },
  { name: "banana", type: "berry" },
  { name: "cherry", type: "drupe" },
  { name: "pear", type: "pome" },
];

const groupedFruits = Object.groupBy(fruits, (f) => f.type);
console.log(groupedFruits);
```

```js
const fruits = [
  { name: "pineappleğŸ", color: "ğŸŸ¡" },
  { name: "appleğŸ", color: "ğŸ”´" },
  { name: "bananağŸŒ", color: "ğŸŸ¡" },
  { name: "strawberryğŸ“", color: "ğŸ”´" },
];
const groupedFruits = Object.groupBy(fruits, (f) => f.color);
console.log(groupedFruits);
```



Map.groupBy( ) ç”¨æ³•å’Œä¸Šé¢çš„ Object.groupBy åŸºæœ¬ç›¸ä¼¼ï¼Œä¸è¿‡è¿”å›çš„æ˜¯ä¸€ä¸ª Map. å¯¹åº”çš„è¯­æ³•å¦‚ä¸‹ï¼š

```js
Map.groupBy(array, callback);
```

- arrayï¼šè¦åˆ†ç»„çš„æ•°ç»„
- callbackï¼šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿”å›çš„å€¼ä½œä¸º Map çš„é”®

```js
const arr = [6.1, 4.2, 6.3];
// æŒ‰ç…§å‘ä¸‹å–æ•´åè¿›è¡Œåˆ†ç»„
const grouped = Map.groupBy(arr, Math.floor);
console.log(grouped);
const grouped2 = Object.groupBy(arr, Math.floor);
console.log(grouped2);
```

å®é™…ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ Lodash é‡Œé¢ä½¿ç”¨é¢‘ç‡æ¯”è¾ƒé«˜çš„æ–¹æ³•ï¼Œéšç€ ES ç‰ˆæœ¬çš„æ›´æ–°ï¼Œè¶Šæ¥è¶Šå¤šä»¥å‰éœ€è¦é ç¬¬ä¸‰æ–¹åº“æ”¯æŒçš„ç‰¹æ€§ï¼Œç›´æ¥åŸç”Ÿå¼€å§‹æ”¯æŒäº†ã€‚



**2. Promise.withResolvers**

Promise.withResolvers æ˜¯ ECMAScript ææ¡ˆä¸­æ–°å¢çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ—¨åœ¨ç®€åŒ–åˆ›å»º Promise åŠå…¶å…³è”çš„ resolve å’Œ reject å‡½æ•°çš„è¿‡ç¨‹ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥æ›´æ–¹ä¾¿åœ°åˆ›å»ºæ‰‹åŠ¨æ§åˆ¶çš„ Promise å¯¹è±¡ï¼Œè€Œæ— éœ€åƒä¼ ç»Ÿæ–¹å¼é‚£æ ·ä½¿ç”¨é¢å¤–çš„å˜é‡ã€‚

å…ˆå›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„æ–¹å¼ã€‚

```js
new Promise((resolve, reject)=>{
  // å¼‚æ­¥å¤„ç†
  // ...
  resolve(...);
})
```

åœ¨ä½¿ç”¨ Promise çš„æ—¶å€™ï¼Œç»å¸¸ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼šéœ€è¦æ‰‹åŠ¨æ§åˆ¶ Promise ä½•æ—¶è¿›è¡Œ resolve æˆ– rejectï¼Œè€Œéåœ¨å¼‚æ­¥æ“ä½œå®Œæˆåè‡ªåŠ¨ resolve æˆ– rejectï¼Œè¿™ç§éœ€æ±‚ä¸‹é€šå¸¸åˆ›å»ºä¸€ä¸ªâ€œå»¶è¿Ÿå¯¹è±¡â€ï¼ˆDeferred Objectï¼‰ï¼Œä»¥ä¾¿åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåå†å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•å¤„ç† Promise.

```js
class Deferred{
  constructor(){
    this.promise = new Promise((resolve, reject)=>{
      this.reoslve = resolve;
      this.reject = reject;
    })
  }
}
const d = new Deferred();
// åæœŸå°±å¯ä»¥æ‰‹åŠ¨æ§åˆ¶ä½•æ—¶è¿›è¡Œ resolve
d.reoslve();
```

ä¸¾ä¸€ä¸ªå®é™…çš„åœºæ™¯ï¼šå‡è®¾æœ‰ä¸€ä¸ªéœ€è¦å‘å¤šä¸ªä¸åŒçš„ç¬¬ä¸‰æ–¹ API å‘é€è¯·æ±‚çš„åº”ç”¨ç¨‹åºã€‚æ¯ä¸ªè¯·æ±‚çš„å“åº”æ—¶é—´å’ŒæˆåŠŸç‡éƒ½ä¸åŒã€‚æˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸåï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚å¦‚æœä»»ä½•ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼Œéƒ½éœ€è¦ç«‹å³åœæ­¢æ•´ä¸ªæµç¨‹ï¼Œå¹¶è¿›è¡Œé”™è¯¯å¤„ç†ã€‚

```js
const apiEndpoints = [
  "https://api.example.com/data1",
  "https://api.example.com/data2",
  "https://api.example.com/data3",
];

/**
 *
 * @param {*} apiEndpoints æ•°ç»„ï¼Œå­˜æ”¾äº†å¤šä¸ªAPIçš„åœ°å€
 */
function fetchMutipleAPIs(apiEndpoints) {
  let resolve, reject; // ä¿å­˜resolveå’Œrejectå‡½æ•°

  const p = new Promise((res, rej) => {
    // å°†ä¸¤ä¸ªæ–¹æ³•æå–å‡ºæ¥ï¼Œå›å¤´å¯ä»¥æ‰‹åŠ¨å†³å®šä»€ä¹ˆæ—¶å€™resolveå’Œreject
    resolve = res;
    reject = rej;
  });

  let completed = 0; // è®°å½•å·²ç»å®Œæˆçš„è¯·æ±‚æ•°é‡
  const total = apiEndpoints.length; // æ€»è¯·æ±‚æ•°é‡
  const results = []; // å­˜æ”¾ç»“æœ

  apiEndpoints.forEach((endPoint, index) => {
    fetchDataFromURL(endPoint)
      .then((data) => {
        results[index] = data;
        completed++;
        if (completed === total) {
          // è¿›å…¥è¯¥åˆ†æ”¯ï¼Œè¯´æ˜æ‰€æœ‰è¯·æ±‚éƒ½å·²ç»å®Œæˆ
          // ç„¶åå†æ‰‹åŠ¨çš„resolveæ•´ä½“çš„ç»“æœ
          resolve(results);
        }
      })
      .catch((e) => {
        console.log("è¯·æ±‚å¤±è´¥error:", e.message);
      });
  });

  return p;
}

function fetchDataFromURL(url) {
  return new Promise((resolve, reject) => {
    const delay = Math.random() * 2000;
    const isSuccessful = Math.random() > 0.2; // 80%çš„æ¦‚ç‡è¯·æ±‚æˆåŠŸ
    setTimeout(() => {
      if (isSuccessful) {
        resolve(`Data from ${url}`);
      } else {
        reject(new Error(`è¯·æ±‚ ${url} å¤±è´¥`));
      }
    }, delay);
  });
}

fetchMutipleAPIs(apiEndpoints)
  .then((result) => {
    console.log("æ‰€æœ‰è¯·æ±‚éƒ½å·²ç»å®Œæˆï¼Œç»“æœä¸º:", result);
  })
  .catch((err) => {
    console.log("è¯·æ±‚å¤±è´¥", err);
  });
```

é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†åœ¨ Promise æ„é€ å‡½æ•°çš„æ‰§è¡Œå™¨å‡½æ•°ä¸­æ‰‹åŠ¨å°† resolve å’Œ reject èµ‹å€¼ç»™å¤–éƒ¨å˜é‡ã€‚è¿™ç§æ–¹å¼è¾ƒä¸ºç¹çï¼Œä¸”ä»£ç ä¸å¤Ÿç®€æ´ã€‚ç›´æ¥ä½¿ç”¨ Promise.withResolversï¼Œå¯ä»¥åœ¨ä¸€è¡Œä»£ç ä¸­åŒæ—¶è·å– promiseã€resolve å’Œ rejectï¼Œä½¿ä»£ç æ›´ç®€æ´æ˜äº†ã€‚

è¯­æ³•å¦‚ä¸‹ï¼š

```js
const { promise, resolve, reject } = Promise.withResolvers();
```

- promiseï¼šä¸€ä¸ªæ–°çš„ Promise å®ä¾‹
- resolveï¼šä¸è¯¥ Promise å®ä¾‹å…³è”çš„ resolve å‡½æ•°
- rejectï¼šä¸è¯¥ Promise å®ä¾‹å…³è”çš„ reject å‡½æ•°

æˆ‘ä»¬ä½¿ç”¨ Promise.withResolvers( ) æ¥é‡æ„ä¸Šé¢çš„åœºæ™¯ç¤ºä¾‹ä»£ç ï¼š

```js
function fetchMutipleAPIs(apiEndpoints) {
  const { promise, resolve, reject } = Promise.withResolvers();

  // ...
  
  return promise;
}
```



**3. æ­£åˆ™è¡¨è¾¾å¼çš„ /v æ ‡å¿—**

/v æ ‡å¿—ä»£è¡¨ **Unicode Sets æ¨¡å¼**ï¼ˆUnicode å±æ€§é›†æ¨¡å¼ï¼‰ã€‚å¼•å…¥è¿™ä¸ªæ ‡å¿—çš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§æ›´å¼ºå¤§ã€æ›´ç›´è§‚çš„æ–¹å¼æ¥å¤„ç† Unicode å­—ç¬¦é›†ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦åŒ¹é…å¤æ‚çš„ Unicode å±æ€§ç»„åˆæ—¶ã€‚

**å½“ä½¿ç”¨ v æ ‡å¿—æ—¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¼•æ“å°†é‡‡ç”¨æ–°çš„è§£ææ–¹å¼**ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–°çš„è¯­æ³•ç‰¹æ€§ï¼š

1. å­—ç¬¦é›†æ“ä½œï¼šæ”¯æŒé›†åˆçš„ å¹¶é›†(`[...||...]`)ã€äº¤é›†(`[...&&...]`)å’Œ å·®é›†(`[...--...]`)

   - ä½¿ç”¨ `||` è¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦é›†çš„å¹¶é›†

     ```js
     // åŒ¹é…æ‹‰ä¸æ–‡æˆ–è€…å¸Œè…Šå­—æ¯ï¼ˆç›®å‰æœ€æ–°çš„ node.js ç¯å¢ƒè¿˜ä¸æ”¯æŒï¼‰
     const regex = /[\p{Script=Latin}||\p{Script=Cyrillic}]/v;
     console.log(regex.test("A")); // è¾“å‡ºï¼štrue
     console.log(regex.test("Ğ‘")); // è¾“å‡ºï¼štrue
     console.log(regex.test("æ±‰")); // è¾“å‡ºï¼šfalse
     ```

   - ä½¿ç”¨ `&&` è¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦é›†çš„äº¤é›†

     ```js
     const regex = /[\p{Alphabetic}&&\p{Script=Latin}]/v;
     console.log(regex.test("A")); // è¾“å‡ºï¼štrue
     console.log(regex.test("1")); // è¾“å‡ºï¼šfalse
     ```

   - ä½¿ç”¨ `--` è¡¨ç¤ºå­—ç¬¦é›†çš„å·®é›†

     ```js
     // åŒ¹é…æ‹‰ä¸æ–‡ï¼Œä½†ä¸åŒ…æ‹¬å°å†™çš„å­—æ¯
     const regex = /[\p{Script=Latin}--\p{Lowercase_Letter}]/v;
     console.log(regex.test("A")); // è¾“å‡ºï¼štrue
     console.log(regex.test("a")); // è¾“å‡ºï¼šfalse
     
     // åŒ¹é…æ‰€æœ‰æ•°å­—ï¼Œä½†ä¸åŒ…æ‹¬ç½—é©¬æ•°å­—ï¼ˆç›®å‰æœ€æ–°çš„ node.js ç¯å¢ƒè¿˜ä¸æ”¯æŒï¼‰
     const regex = /[\p{Number}--\p{Numeric_Type=Numeric}]/v;
     console.log(regex.test("5")); // è¾“å‡ºï¼štrue
     console.log(regex.test("â…£")); // è¾“å‡ºï¼šfalse
     ```

2. åµŒå¥—çš„å­—ç¬¦ç±»ï¼šå¯ä»¥åœ¨å­—ç¬¦ç±»å†…éƒ¨ä½¿ç”¨å­—ç¬¦ç±»

   ```js
   const regex = /[[a-f]&&[d-z]]/v;
   console.log(regex.test("e")); // è¾“å‡ºï¼štrue
   console.log(regex.test("b")); // è¾“å‡ºï¼šfalse
   ```

æœ€åè¦è¯´çš„æ˜¯ï¼Œ/v æ ‡å¿—ç›®å‰ä»æ˜¯**ææ¡ˆé˜¶æ®µ**ï¼Œéœ€ç¡®è®¤è¿è¡Œç¯å¢ƒæ˜¯å¦æ”¯æŒã€‚



ES2024 å…¶ä»–æ–°ç‰¹æ€§ï¼š

- å¯è°ƒæ•´å¤§å°çš„ ArrayBuffer
- Atomics.waitAsync( ) æ–¹æ³•
- å­—ç¬¦ä¸² isWellFormed( ) å’Œ toWellFormed( ) æ–¹æ³•

---

-EOF-

