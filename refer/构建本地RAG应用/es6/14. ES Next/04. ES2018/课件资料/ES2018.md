# ES2018

ES2018ï¼ˆES9ï¼‰å¼•å…¥äº†ä¸€äº›é‡è¦çš„æ–°ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯å¯¹æ­£åˆ™è¡¨è¾¾å¼ã€å¼‚æ­¥è¿­ä»£å’Œå¯¹è±¡çš„å¢å¼ºã€‚

1. Asynchronous Iteration (for await...of)
2. Rest/Spread Properties for Objects
3. RegExp Named Capture Groups
4. RegExp Lookbehind Assertions
5. RegExp Unicode Property Escapes
6. s (dotAll) Flag for Regular Expressions
7. Promise.prototype.finally( )



**1. Asynchronous Iteration (for await...of)**

ES2018 æ·»åŠ äº† for await...of å¾ªç¯ï¼Œç”¨äº**è¿­ä»£å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡**ã€‚è¿™ç§è¯­æ³•å…è®¸ä½ åœ¨å¼‚æ­¥æµä¸­**é€æ­¥è·å–æ•°æ®**ï¼Œéå¸¸é€‚åˆå¤„ç†å¼‚æ­¥æ•°æ®æµï¼ˆå¦‚ç½‘ç»œè¯·æ±‚æˆ–è¯»å–æ–‡ä»¶æµï¼‰ã€‚

ä¸€ä¸ªåŸºç¡€çš„ç¤ºä¾‹ï¼š

```js
const asyncObj = {
  async *[Symbol.asyncIterator]() {
    yield 1;
    yield 2;
    yield 3;
  },
};

async function proceeAsyncData(data) {
  for await (let item of data) {
    console.log(item);
  }
}

proceeAsyncData(asyncObj);
```

å®é™…åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š

å‡è®¾æˆ‘ä»¬å¼€å‘ä¸€ä¸ªä»æœåŠ¡å™¨ä¸Šåˆ†é¡µè·å–ç”¨æˆ·æ•°æ®çš„åº”ç”¨ï¼Œæ¯æ¬¡åªèƒ½è·å–ä¸€é¡µï¼ˆå¦‚10ä¸ªç”¨æˆ·ï¼‰çš„æ•°æ®ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆã€‚è¿™ä¸ªåœºæ™¯åœ¨å®é™…å¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§æ•°æ®é›†æ—¶ã€‚

```js

/**
 * æ ¹æ®ä¼ å…¥çš„é¡µç æ•°è¿”å›å¯¹åº”é¡µç çš„ç”¨æˆ·æ•°æ®
 * @param {*} page é¡µç æ•°
 */
async function fetchUser(page) {
  // å‡è®¾æ¯é¡µ10ä¸ªç”¨æˆ·
  const pageSize = 10;

  // æ¨¡æ‹ŸæœåŠ¡å™¨å»¶è¿Ÿ
  await new Promise((resolve) => setTimeout(resolve, 1500));

  // æ€»å…±çš„ç”¨æˆ·æ•°æ®
  const totalUsers = 45;

  // è®¡ç®—å½“å‰é¡µå¯¹åº”çš„èµ·å§‹å€¼å’Œç»“æŸå€¼
  const start = (page - 1) * pageSize;
  const end = Math.min(start + pageSize, totalUsers);

  // å¦‚æœæ²¡æœ‰æ›´å¤šçš„ç”¨æˆ·ï¼Œå°±è¿”å›ç©ºæ•°ç»„
  if (start >= totalUsers) return [];

  // ç”Ÿæˆå½“å‰é¡µçš„ç”¨æˆ·æ•°æ®
  const users = Array.from({ length: end - start }, (_, i) => {
    return {
      id: start + i + 1,
      name: `ç”¨æˆ·${start + i + 1}`,
    };
  });

  return users;
}

// å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°ï¼šåˆ†é¡µè·å–æ‰€æœ‰çš„ç”¨æˆ·
async function* fetchAllUsers() {
  let page = 1; // ä¸€å¼€å§‹ä»ç¬¬ä¸€é¡µå¼€å§‹
  let hasMore = true; // æ˜¯å¦è¿˜æœ‰æ›´å¤šçš„ç”¨æˆ·æ•°æ®

  while (hasMore) {
    // æ ¹æ®å½“å‰é¡µç æ‹¿åˆ°å¯¹åº”çš„ç”¨æˆ·æ•°æ®
    const users = await fetchUser(page);
    if (users.length === 0) {
      hasMore = false;
    } else {
      yield users;
      page++;
    }
  }
}

async function processAllUsers() {
  let allUsers = [];

  for await (let users of fetchAllUsers()) {
    console.log(`å½“å‰é¡µçš„ç”¨æˆ·æ•°æ®ï¼š`, users);
    allUsers = allUsers.concat(users);
  }

  console.log(`æ‰€ç”¨çš„ç”¨æˆ·æ•°æ®ï¼š`, allUsers);
}
processAllUsers();
```



**2. Rest/Spread Properties for Objects**

åœ¨ ES2018 ä¸­ï¼Œ... è¿ç®—ç¬¦ï¼ˆä¹Ÿç§°ä¸ºâ€œæ‰©å±•è¿ç®—ç¬¦â€ï¼‰å¯ä»¥ç”¨äºå¯¹è±¡ã€‚

- é€šè¿‡ rest è¿ç®—ç¬¦ï¼Œå¯ä»¥å°†å¯¹è±¡çš„å…¶ä½™å±æ€§æå–åˆ°æ–°å¯¹è±¡ä¸­
- é€šè¿‡ spread è¿ç®—ç¬¦ï¼Œå¯ä»¥å°†å¯¹è±¡çš„å±æ€§åˆå¹¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸­

restç¤ºä¾‹ï¼š

```js
const { a, b, ...rest } = { a: 1, b: 2, c: 3, d: 4, e: 5 };
console.log(a, b, rest); // 1 2 { c: 3, d: 4, e: 5 }
```

spreadç¤ºä¾‹ï¼š

```js
const o1 = {
  a: 1,
  b: 2,
};
const o2 = {
  c: 3,
  d: 4,
};
const merged = { ...o1, ...o2 };
console.log(merged);
```



**3. RegExp Named Capture Groups**

ES2018 å¢åŠ äº†åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ **å‘½åæ•è·ç»„** çš„åŠŸèƒ½ã€‚é€šè¿‡å‘½åæ•è·ç»„ï¼Œä½ å¯ä»¥ç»™æ•è·çš„å­å­—ç¬¦ä¸²å‘½åï¼Œä¾¿äºåç»­å¤„ç†å’Œå¼•ç”¨ã€‚

å…ˆçœ‹ä¸€ä¸‹ä»¥å‰æ•è·ç»„æ²¡æœ‰å‘½åçš„ä¾‹å­ï¼š

```js
// æ²¡æœ‰ä½¿ç”¨å‘½åæ•è·ç»„
const regex = /(\d{4})-(\d{2})-(\d{2})/;
const result = regex.exec("2024-09-11");

console.log(result[0]); // '2024-09-11' (æ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²)
console.log(result[1]); // '2024' (ç¬¬ä¸€ç»„æ•è·åˆ°çš„å¹´ä»½)
console.log(result[2]); // '09' (ç¬¬äºŒç»„æ•è·åˆ°çš„æœˆä»½)
console.log(result[3]); // '11' (ç¬¬ä¸‰ç»„æ•è·åˆ°çš„æ—¥æœŸ)
```

ç°åœ¨å¯ä»¥ç›´æ¥ä¸ºæ•è·ç»„æ·»åŠ å‘½åäº†ï¼š

```js
const regex = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;
const result = regex.exec("2024-09-11");

console.log(result);
console.log(result.groups); // { year: '2024', month: '09', day: '11' }
console.log(result.groups.year); // '2024' (ç¬¬ä¸€ç»„æ•è·åˆ°çš„å¹´ä»½)
console.log(result.groups.month); // '09' (ç¬¬äºŒç»„æ•è·åˆ°çš„æœˆä»½)
console.log(result.groups.day); // '11' (ç¬¬ä¸‰ç»„æ•è·åˆ°çš„æ—¥æœŸ)
```



**4. RegExp Lookbehind Assertions**

ES2018 ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ**åè¡Œæ–­è¨€**ï¼Œä¹Ÿç§°ä¸ºâ€œlookbehind assertionsâ€ã€‚

æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„â€œ**æ–­è¨€**â€å¯ä»¥ç†è§£ä¸ºå¯¹æŸä¸ªä½ç½®åšå‡ºä¸€ä¸ª**æ¡ä»¶æ£€æŸ¥**ï¼Œä½†**æœ¬èº«å¹¶ä¸æ¶ˆè€—å­—ç¬¦**ã€‚æ–­è¨€çš„æœ¬è´¨æ˜¯â€œ**åœ¨è¿™é‡Œçš„å‰é¢/åé¢æ˜¯å¦æœ‰æŸä¸ªä¸œè¥¿**â€ï¼Œè€Œ**ä¸ä¼šå°†è¿™ä¸ªä¸œè¥¿ä½œä¸ºåŒ¹é…ç»“æœçš„ä¸€éƒ¨åˆ†**ã€‚

å¿«é€Ÿä¸Šæ‰‹ç¤ºä¾‹ï¼šæ£€æŸ¥ä¸€ä¸ªæ•°å­—åé¢æ˜¯å¦æœ‰ px å­—ç¬¦ä¸²

å‡è®¾æƒ³åŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œä½†è¿™ä¸ªæ•°å­—åé¢å¿…é¡»æœ‰ pxï¼Œ**ä¸”ä½ åªæƒ³è¦è¿™ä¸ªæ•°å­—**ï¼Œä¸åŒ…æ‹¬ px æœ¬èº«ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£å‘å‰è¡Œæ–­è¨€æ¥å®ç°ï¼š

```js
const reg = /\d+(?=px)/; //åŒ¹é…æ•°å­—ï¼Œå¹¶ä¸”åé¢æ˜¯px
console.log("123px".match(reg)); // [ '123', index: 0, input: '123px', groups: undefined ]
```

æ—©æœŸåªæ”¯æŒ **å‰è¡Œæ–­è¨€**ï¼š

1. æ­£å‘å‰è¡Œæ–­è¨€ (?=...)ï¼šæ£€æŸ¥æŸä¸ªæ¨¡å¼çš„ **åé¢** æ˜¯å¦**æœ‰**ç‰¹å®šå­—ç¬¦ã€‚

   ```js
   const reg = /\d+(?=px)/;
   ```

2. è´Ÿå‘å‰è¡Œæ–­è¨€ (?!...)ï¼šæ£€æŸ¥æŸä¸ªæ¨¡å¼çš„ **åé¢** æ˜¯å¦ **æ²¡æœ‰** ç‰¹å®šå­—ç¬¦ã€‚

   ```js
   const reg = /\d+(?!px)/; //åŒ¹é…æ•°å­—ï¼Œå¹¶ä¸”åé¢ä¸æ˜¯px
   console.log("123ab".match(reg)); // [ '123', index: 0, input: '123ab', groups: undefined ]
   ```

ä» ES2018 å¼€å§‹æ”¯æŒ **åè¡Œæ–­è¨€**ï¼š

1. æ­£å‘åè¡Œæ–­è¨€ï¼ˆ?<=...ï¼‰ï¼šç¡®ä¿æŸä¸ªæ¨¡å¼**å‰é¢** æ˜¯å¦**æœ‰**ç‰¹å®šå­—ç¬¦

   ```js
   // åŒ¹é…æ•°å­—ï¼Œä½†æ˜¯æ•°å­—å‰é¢èƒ½æœ‰$
   const reg = /(?<=\$)\d+/;
   console.log("100$456".match(reg)); // [ '456', index: 4, input: '100$456', groups: undefined ]
   ```

2. è´Ÿå‘åè¡Œæ–­è¨€ï¼ˆ?<!...ï¼‰ï¼šç¡®ä¿æŸä¸ªæ¨¡å¼**å‰é¢** æ˜¯å¦**æ²¡æœ‰**ç‰¹å®šå­—ç¬¦

   ```js
   const reg = /(?<!\$)\d+/;
   console.log("100$456".match(reg)); // [ '100', index: 0, input: '100$456', groups: undefined ]
   ```



**5. RegExp Unicode Property Escapes**

ES2018 ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¼•å…¥äº†**Unicode å±æ€§è½¬ä¹‰**ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡ \p{ } å’Œ \P{ } è¯­æ³•åŒ¹é…å…·æœ‰ç‰¹å®š Unicode å±æ€§çš„å­—ç¬¦ã€‚è¿™æå¤§å¢å¼ºäº†å¤„ç†å¤šè¯­è¨€å­—ç¬¦çš„èƒ½åŠ›ã€‚

- \p{ } : æŒ‡å®šå¯¹åº”çš„ Unicode å­—ç¬¦ï¼ˆæŒ‡å®šæ±‰è¯­ã€æ‹‰ä¸è¯­ã€å¸Œè…Šè¯­...ï¼‰
- \P{ }: æŒ‡å®šä¸èƒ½æœ‰å¯¹åº”çš„ Unicode å­—ç¬¦ï¼ˆç›¸å½“äºæ’é™¤ï¼‰

```js
const regExp = /\p{Script=Greek}/u;
console.log("Î±".match(regExp)); // [ 'Î±', index: 0, input: 'Î±', groups: undefined ]
console.log("a".match(regExp)); // null


const regExp2 = /\p{Script=Han}/u;
console.log(regExp2.test("ä½ å¥½")); // true

const regExp3 = /\p{Emoji}/u;
console.log(regExp3.test("ğŸ˜„")); // true
```



**6. s (dotAll) Flag for Regular Expressions**

æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ . æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œç”¨æ¥åŒ¹é…é™¤æ¢è¡Œç¬¦ï¼ˆ\nï¼‰ä¹‹å¤–çš„**ä»»ä½•å•ä¸ªå­—ç¬¦**ã€‚åœ¨ ES2018 ä¹‹å‰ï¼Œ. ä¸èƒ½åŒ¹é…æ¢è¡Œç¬¦ï¼Œå› æ­¤å½“ä½ éœ€è¦åŒ¹é…è·¨è¡Œçš„æ–‡æœ¬æ—¶ï¼Œéœ€è¦ç¼–å†™æ›´å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼æ¥å¤„ç†æ¢è¡Œç¬¦ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```js
const regex = /foo.bar/;
const str = "foo\nbar";
console.log(regex.test(str)); // false
```

äºæ˜¯åªèƒ½æ›²çº¿æ•‘å›½ï¼Œä½¿ç”¨ `[\s\S]`ï¼Œå…¶ä¸­ \s åŒ¹é…ç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ï¼‰ï¼Œ\S åŒ¹é…éç©ºç™½å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥è®© . çš„åŠŸèƒ½æ‰©å±•åˆ°æ‰€æœ‰å­—ç¬¦ã€‚

```js
const regex = /foo[\s\S]bar/;
const str = "foo\nbar";
console.log(regex.test(str)); // true
```

ES2018 å¼•å…¥äº† s æ ‡å¿—ï¼ˆä¹Ÿå« dotAll æ¨¡å¼ï¼‰ï¼Œè®© . èƒ½å¤ŸåŒ¹é…åŒ…æ‹¬æ¢è¡Œç¬¦åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œä»è€Œç®€åŒ–äº†è·¨è¡Œæ–‡æœ¬çš„åŒ¹é…ã€‚

```js
const regex = /foo.bar/s;
const str = "foo\nbar";
console.log(regex.test(str)); // true
```



**7. Promise.prototype.finally( )**

ES2018 ä¸º Promise å¯¹è±¡æ·»åŠ äº† finally( ) æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ åœ¨ Promise è¢«å¤„ç†å®Œï¼ˆä¸è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰ä¹‹åæ‰§è¡Œä»£ç ã€‚æ— è®º Promise çš„ç»“æœæ˜¯ resolve è¿˜æ˜¯ rejectï¼Œfinally( ) ä¸­çš„ä»£ç éƒ½ä¼šæ‰§è¡Œã€‚è¿™éå¸¸é€‚åˆè¿›è¡Œæ¸…ç†æ“ä½œã€‚

```js
fetch("./data.json")
  .then((response) => response.json())
  .catch((error) => console.error("Error:", error))
  .finally(() => console.log("Finished fetching data."));
```

å®é™…åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼šæ•°æ®åŠ è½½æ—¶çš„ç½‘ç»œè¯·æ±‚ + åŠ è½½åŠ¨ç”»

```js
function showLoading() {
  console.log("loading...");
}

function hideLoading() {
  console.log("hide loading...");
}

// è¯·æ±‚æ•°æ®
function fetchData() {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const isSuccess = Math.random() > 0.5;
      if (isSuccess) {
        resolve("æ•°æ®åŠ è½½æˆåŠŸ");
      } else {
        reject("æ•°æ®åŠ è½½å¤±è´¥");
      }
    }, 2000);
  });
}

function loadData() {
  showLoading();
  fetchData()
    .then((data) => {
      console.log("æˆåŠŸï¼š", data);
    })
    .catch((err) => {
      console.log("å¤±è´¥ï¼š", err);
    })
    .finally(() => {
      // æ— è®ºè¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šæ‰§è¡Œ
      hideLoading();
    });
}
loadData();
```

---

-EOF-